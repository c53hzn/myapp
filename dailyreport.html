
<!DOCTYPE html>
<html lang="zh">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
	<title>客服工作日志</title>
	<style>
	.visibleEntry{word-wrap: break-word; word-break: break-all;}
	</style>
</head>

<body>
	<h4>&nbsp;</h4>
	<div class="row">
		<div class="col-lg-10 col-lg-offset-1">
			<div class="panel panel-default">
				<!--文档信息区开始-->
				<h1 class="text-center"><客服工作日志></h1>
				<div class="row">
					<div class="col-sm-6">
						<div class="text-center">
							<span>
								日期：
							</span>
							<span id="myDate">
								年 月 日 星期
							</span>
						</div>
					</div>
					<div class="col-sm-6">
						<div class="text-center">
							<span>员工：</span>
							<input id="myName" type="text">
						</div>
					</div>
				</div>
				<!--文档信息区结束-->
				<h4 class="text-center"><b>重要目标：协助用户在最短的时间内解决问题！将用户的意见传达给公司</b></h4>
				<div class="row">
					<div class="col-sm-10 col-sm-offset-1">
						<table class="table table-striped table-bordered">
							<tbody>
								<tr>
									<td>接触方向</td>
									<td>接触方式</td>
									<td>联络人：<br>电话/QQ</td>
									<td>SoldEazy-ID</td>
									<td>问题描述<br>最好有例子</td>
									<td>教学编号</td>
									<td>成功解决？</td>
									<td>跟进/<br>转介？</td>
								</tr>
								<tr>
									<td>
										<select id="inOrOut" class="form-control" style="width: 65px;">
											<option selected="selected" disabled="disabled"  style='display: none'></option>
										    <option>入</option>
										    <option>出</option>
										</select>
									</td>
									<td>
										<select id="touchMethod" class="form-control" style="width: 65px;">
											<option selected="selected" disabled="disabled"  style='display: none'></option>
										    <option>QQ</option>
										    <option>电话</option>
										</select>
									</td>
									<td><input id="contactNum" class="form-control" type="text" style="width: 100px;"></td>
									<td><input id="seId" type="text" class="form-control" style="width: 80px;"></td>
									<td><textarea class="form-control" id="queryDetail" style="width: 200px; height: 150px;"></textarea></td>
									<td><input id="qaNum" class="form-control" type="text" style="width: 80px;"></td>
									<td>
										<select id="solvedOrNot" class="form-control" style="width: 65px;">
											<option selected="selected" disabled="disabled"  style='display: none'></option>
										    <option>是</option>
										    <option>否</option>
										</select>
									</td>
									<td><input id="needFollowUp" class="form-control" type="text" style="width: 80px;"></td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-10 col-sm-offset-1">
						<button id="addNew" class="btn btn-primary">新增一条</button>
						<button id="delLast" class="btn btn-danger">删除一条</button>
					</div>
				</div>
				<div class="row">
					<h3 class="text-center">今天的记录</h3>
					<div class="col-sm-10 col-sm-offset-1">
						<table id="recordToday" class="table table-striped table-bordered">
							<tbody>
								<tr>
									<td style="width: 45px;">序号</td>
									<td style="width: 75px;">接触方向</td>
									<td style="width: 75px;">接触方式</td>
									<td style="width: 105px;">联络人：<br>电话/QQ</td>
									<td style="width: 105px;">SoldEazy-ID</td>
									<td>问题描述</td>
									<td style="width: 85px;">教学编号</td>
									<td style="width: 95px;">成功解决？</td>
									<td style="width: 95px;">跟进/<br>转介？</td>
								</tr>
								<tr>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
									<td>&nbsp;</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="row">
					<div class="col-sm-10 col-sm-offset-1">
						<!-- <button id="submitBtn" class="btn btn-primary">全部提交</button> -->
						<button id="exportBtn" class="btn btn-primary">导出csv</button>
					</div>
				</div>
				<h4>&nbsp;</h4>
			</div>
		</div>
	</div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" type="text/javascript"></script>
	<!-- <script src="https://cdn.rawgit.com/unconditional/jquery-table2excel/master/src/jquery.table2excel.js" type="text/javascript"></script> -->
	<script src="https://cdn.jsdelivr.net/npm/tableexport.jquery.plugin@1.9.9/tableExport.min.js" type="text/javascript"></script>
	<!-- <script src="https://cdn.bootcss.com/FileSaver.js/2014-11-29/FileSaver.min.js"></script> -->
	<script>
		//定义星期几
		var weekday=new Array(7);
		weekday[0]="星期日";
		weekday[1]="星期一";
		weekday[2]="星期二";
		weekday[3]="星期三";
		weekday[4]="星期四";
		weekday[5]="星期五";
		weekday[6]="星期六";
		$(document).ready(function(){
			/*页面加载完成后显示日期*/
			var dateNow = new Date();
			var year = dateNow.getFullYear();
			var month = dateNow.getMonth() + 1;
			var day = dateNow.getDate();
			var theDay = dateNow.getDay();
			if(year < 10){
				year = "0" + year;
			}
			if(month < 10){
				month = "0" + month;
			}
			if(day < 10){
				day = "0" + day;
			}
			(function(){
				$("#myDate").html(year + "年" + month + "月" + day + "日" + weekday[theDay]);
			})();

			function updateSequence(){
				var visibleRef = $(".visibleEntry td:first-child");
				for(var i = 0; i < visibleRef.length; i++){
					visibleRef[i].innerHTML = i + 1;
				}
			}

			$("#addNew").on("click",function(){
				var newEntry = [];
				var val01 = "", val02 = "", val03 = "", val04 = "", val05 = "", val06 = "", val07 = "", val08 = "";
				if($("#inOrOut").val() != "入" && $("#inOrOut").val() != "出"){
					val01 = "方向只能是“出”或“入”\n";
				}
				if($("#touchMethod").val() != "QQ" && $("#touchMethod").val() != "电话"){
					val02 = "方式只能是QQ或电话\n";
				}
				if(!$("#contactNum").val().match(/^(\d|\+)+$/)){
					val03 = "联系方式只能输入数字\n";
				}
				if(!$("#seId").val().match(/^\w+$/)){
					val04 = "账号名只能是字母和数字的组合\n";
				}
				// if(!$("#queryDetail").val().match(/^[\u4e00-\u9fa5_a-zA-Z0-9]+$/)){
				// 	// val05 = "问题描述格式不正确\n";
				// }
				if(!$("#qaNum").val().match(/^[\u4e00-\u9fa5_a-zA-Z0-9]+$/)){
					val06 = "教学编号不正确\n";
				}
				if($("#solvedOrNot").val() != "是" && $("#solvedOrNot").val() != "否"){
					val07 = "到底解决没有？\n";
				}
				if(!$("#needFollowUp").val().match(/^[\u4e00-\u9fa5_a-zA-Z0-9]+$/)){
					val08 = "需要跟进吗？";
				}
				var msg = val01 + val02 + val03 + val04 + val05 + val06 + val07 + val08;
				if(!msg){
					newEntry.push($("#inOrOut").val());
					newEntry.push($("#touchMethod").val());
					newEntry.push($("#contactNum").val());
					newEntry.push($("#seId").val());
					newEntry.push($("#queryDetail").val());
					newEntry.push($("#qaNum").val());
					newEntry.push($("#solvedOrNot").val());
					newEntry.push($("#needFollowUp").val());
					var newTr = [];
					newEntry.forEach(function(m){
						m = "<td>" + m + "</td>";
						newTr.push(m);
					});
					var joinedTr = "<tr class='visibleEntry'><td></td>" + newTr.join("") + "</tr>";
					var veryFirstTd = $("#recordToday tr:nth-child(2)").children("td")[0];
					console.log(veryFirstTd);
					if($(veryFirstTd).html() == "&nbsp;"){
						$("#recordToday tr:nth-child(2)").remove();
					}
					$("#recordToday tbody").append(joinedTr);
					updateSequence();
				}else{
					alert(msg);
				}
			});

			$("#delLast").click(function(){
				var veryLastTd = $("#recordToday tr:last-child").children("td")[0];
				if($("#recordToday tr").length == 2){
					if($(veryLastTd).html() != "&nbsp;"){
						$("#recordToday tr:last-child").remove();
						var vacantLine = "<tr><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr>";
						$("#recordToday tbody").append(vacantLine);
					}
				}else{
					console.log($("#recordToday tr").length);
					$("#recordToday tr:last-child").remove();
				}
			});

			$("#exportBtn").click(function(){
				if(!$("#myName").val()){
					alert("你的名字是？");
				}else{
					if(confirm("确认导出？")){
						var myFileName = year + month + day + "DailyWorksheet_" + $("#myName").val();
						console.log(myFileName);

						/*table2excel方法*/
						// $("#recordToday").table2excel({
						// 	// 不被导出的表格行的CSS class类
						// 	exclude: ".noExl",
						// 	// 导出的Excel文档的名称
						// 	name: "Excel Document Name",
						// 	// Excel文件的名称
						// 	filename: myFileName
						// });

						/*tableExport方法*/
						$("#recordToday").tableExport({
							format:'csv',
							fileName:myFileName
						});
					}
				}
			});

			/*现在做不到提交*/
			// $("#submitBtn").click(function(){
			// 	if(!$("#myName").val()){
			// 		alert("你的名字是？");
			// 	}else{
			// 		if(confirm("确认提交？")){
			// 		}
			// 	}
			// });
		});
	</script>
</body>

</html>
